# Bot Blocking Strategy Report â€” February 2026

## Scope
This report summarizes the strategy changes implemented during February 2026 for the `lareferencia-bot-blocker` project, including why the changes were made and their operational impact.

## Initial Problem
The original blocking model was mainly `/24`-centric (RPM + sustained activity).

Observed traffic pattern:
- Very high request volume.
- Extremely high IP cardinality (many unique IPs).
- Highly distributed low-and-slow behavior per `/24`.
- Most requests concentrated on `/vufind/Record/...` with sparse per-subnet intensity.

Result:
- Many abusive sources stayed below per-`/24` thresholds.
- CPU remained high while few (or no) `/24` blocks were triggered.

## Changes Implemented

### 1. Added coverage diagnostics script
File:
- `subnet_coverage_report.py`

Purpose:
- Measure what traffic is being blocked vs. missed.
- Show top unblocked subnets by request volume.
- Explain miss reason (RPM gap, sustained gap, both).
- Surface "near miss" candidates.

Why:
- Needed objective metrics to tune thresholds safely.

### 2. Corrected dynamic threshold trigger edge
File:
- `strategies/unified.py`

Change:
- CPU aggressive mode trigger changed from `>` to `>=` threshold.

Why:
- Align behavior with documented intent.
- Avoid boundary mismatch at exact threshold values.

### 3. Replaced optional near-miss mode with a principal `/16` distributed-pressure mode
File:
- `blocker.py`

What changed:
- Removed near-miss optional flags (`--near-miss-*`).
- Introduced principal `/16` aggregation in block mode.
- Added `/16` pressure thresholds:
  - `--supernet-min-rpm-total`
  - `--supernet-min-ip-count`
  - `--supernet-min-requests`
- `/16` blocking now runs as a core stage when CPU is in aggressive mode.

Why:
- Attack shape was distributed across many `/24` networks.
- Aggregating pressure at `/16` is more effective for this pattern.

### 4. Updated reporting and docs
Files:
- `blocker.py`
- `README.md`

What changed:
- Parameter summary now reports distributed `/16` thresholds.
- Documentation now describes the principal `/16` pressure model instead of near-miss mode.

## Strategy Evolution (Before vs After)

Before:
- Primary decision: `/24` local intensity and sustained activity.
- `/16` escalation was limited and optional.

After:
- Keep `/24` strategy scoring for direct offenders.
- Add principal `/16` distributed-pressure decision under high system load.
- Better capture of evasive distributed bot traffic.

## Operational Outcomes Observed
- Confirmed effective blocking of several abusive `/16` ranges when thresholds were met.
- In later windows, attackers rotated into new ranges, showing adaptive behavior.
- Model now catches both:
  - Local heavy `/24` offenders.
  - Distributed `/16` pressure patterns.

## Current Recommended Runtime Profile
- `--min-rpm-threshold 6`
- `--min-sustained-percent 20`
- `--max-cpu-load-threshold 75`
- `--supernet-min-rpm-total 4.5`
- `--supernet-min-ip-count 80`
- `--supernet-min-requests 150`
- `--block-duration 120`

Use `--dry-run` first for validation in any major retuning.

## Risks and Mitigations
Risks:
- Overblocking legitimate crawlers or partner traffic at `/16` scope.

Mitigations:
- Maintain a strict, validated whitelist.
- Keep strike-based escalation and expiration cleanup active.
- Re-tune `/16` thresholds based on hourly evidence, not one-off spikes.

## Next Steps
1. Keep monitoring blocked `/16` churn and false positive feedback.
2. Build a periodic report from `subnet_coverage_report.py` output.
3. Add trusted bot/IP validation workflow (reverse DNS + ASN checks) before broad whitelisting.
